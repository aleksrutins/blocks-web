const blockDefinitions =
    [{"filename":"FtcBlocksProjects_common.js"},{"filename":"FtcBlocks_common.js"},{"filename":"acceleration.js"},{"filename":"acceleration_sensor.js"},{"filename":"analog_input.js"},{"filename":"analog_output.js"},{"filename":"android_accelerometer.js"},{"filename":"android_gyroscope.js"},{"filename":"android_orientation.js"},{"filename":"android_sound_pool.js"},{"filename":"android_text_to_speech.js"},{"filename":"angular_velocity.js"},{"filename":"bno055imu.js"},{"filename":"bno055imu_parameters.js"},{"filename":"clipboard_util.js"},{"filename":"color.js"},{"filename":"color_range_sensor.js"},{"filename":"color_sensor.js"},{"filename":"compass_sensor.js"},{"filename":"cr_servo.js"},{"filename":"dbg_log.js"},{"filename":"dc_motor.js"},{"filename":"digital_channel.js"},{"filename":"distance_sensor.js"},{"filename":"elapsed_time.js"},{"filename":"elapsed_time2.js"},{"filename":"file_manager.js"},{"filename":"gamepad.js"},{"filename":"gyro_sensor.js"},{"filename":"hardware_util.js"},{"filename":"images"},{"filename":"images.css"},{"filename":"ir_seeker_sensor.js"},{"filename":"led.js"},{"filename":"light_sensor.js"},{"filename":"linear_op_mode.js"},{"filename":"locale.js"},{"filename":"magnetic_flux.js"},{"filename":"matrix_f.js"},{"filename":"misc.js"},{"filename":"mr_i2c_compass_sensor.js"},{"filename":"mr_i2c_range_sensor.js"},{"filename":"navigation.js"},{"filename":"open_gl_matrix.js"},{"filename":"optical_distance_sensor.js"},{"filename":"orientation.js"},{"filename":"pidf_coefficients.js"},{"filename":"position.js"},{"filename":"project_util.js"},{"filename":"quaternion.js"},{"filename":"range.js"},{"filename":"rev_blinkin_led_driver.js"},{"filename":"rumble_effect.js"},{"filename":"runtime.js"},{"filename":"samples"},{"filename":"servo.js"},{"filename":"servo_controller.js"},{"filename":"sound_util.js"},{"filename":"system.js"},{"filename":"telemetry.js"},{"filename":"temperature.js"},{"filename":"tfod.js"},{"filename":"tfod_base.js"},{"filename":"tfod_current_game.js"},{"filename":"tfod_custom_model.js"},{"filename":"tfod_recognition.js"},{"filename":"tfod_rover_ruckus.js"},{"filename":"tfod_sky_stone.js"},{"filename":"toolbox_util.js"},{"filename":"touch_sensor.js"},{"filename":"ultrasonic_sensor.js"},{"filename":"vars.js"},{"filename":"vector_f.js"},{"filename":"velocity.js"},{"filename":"voltage_sensor.js"},{"filename":"vuforia.js"},{"filename":"vuforia_current_game.js"},{"filename":"vuforia_localizer.js"},{"filename":"vuforia_localizer_parameters.js"},{"filename":"vuforia_relic_recovery.js"},{"filename":"vuforia_rover_ruckus.js"},{"filename":"vuforia_sky_stone.js"},{"filename":"vuforia_trackable.js"},{"filename":"vuforia_trackable_default_listener.js"},{"filename":"vuforia_trackables.js"}]
    .map(x => x.filename)
    .filter(f => f.endsWith('.js'))
    .map(f => '/blocks/' + f)

const ftcBlockly = 
    [{"filename":"ftcjava","parent":"ftcblockly/generators"},{"filename":"ftcjava.js","parent":"ftcblockly/generators"},{"filename":"lists.js","parent":"ftcblockly/generators/ftcjava"},{"filename":"logic.js","parent":"ftcblockly/generators/ftcjava"},{"filename":"loops.js","parent":"ftcblockly/generators/ftcjava"},{"filename":"math.js","parent":"ftcblockly/generators/ftcjava"},{"filename":"procedures.js","parent":"ftcblockly/generators/ftcjava"},{"filename":"text.js","parent":"ftcblockly/generators/ftcjava"},{"filename":"variables.js","parent":"ftcblockly/generators/ftcjava"}]
    .filter(x => x.filename.endsWith('.js'))
    .map(x => '/' + x.parent + '/' + x.filename);

const jsFiles = [...ftcBlockly, ...blockDefinitions].map(f => fetch(f));

const xmlFilesToolbox = 
    // Generated by jc - https://github.com/kellyjonbrazil/jc
    [{"filename":"android_accelerometer.xml"},{"filename":"android_gyroscope.xml"},{"filename":"android_orientation.xml"},{"filename":"android_sound_pool.xml"},{"filename":"android_text_to_speech.xml"},{"filename":"bno055imu_parameters.xml"},{"filename":"gamepad.xml"},{"filename":"linear_op_mode.xml"},{"filename":"misc.xml"},{"filename":"navigation_switchableCamera.xml"},{"filename":"rev_blinkin_led_driver.xml"},{"filename":"tensorFlowObjectDetection.xml"},{"filename":"utilities.xml"},{"filename":"vuforia.xml"},{"filename":"vuforiaCurrentGame_initialize_withCameraDirection.xml"},{"filename":"vuforiaCurrentGame_initialize_withWebcam.xml"},{"filename":"vuforiaCurrentGame_setActiveCamera.xml"},{"filename":"vuforiaLocalizerParameters_addWebcamCalibrationFile.xml"},{"filename":"vuforiaLocalizerParameters_getProperty_CameraDirection.xml"},{"filename":"vuforiaLocalizerParameters_getProperty_CameraName.xml"},{"filename":"vuforiaLocalizerParameters_setCameraDirection.xml"},{"filename":"vuforiaLocalizerParameters_setCameraName.xml"},{"filename":"vuforiaSkyStone_initialize_withCameraDirection.xml"},{"filename":"vuforiaSkyStone_initialize_withWebcam.xml"},{"filename":"vuforiaSkyStone_setActiveCamera.xml"},{"filename":"vuforiaTrackableDefaultListener_setCameraLocationOnRobot.xml"},{"filename":"vuforiaTrackableDefaultListener_setPhoneInformation.xml"}]
    // end generated
    .map(x => x.filename)
    .map(f => '/toolbox/' + f)
    .map(f => fetch(f));

let toolbox = '<xml>';

Promise.all(jsFiles).then(files => Promise.all(files.map(async f => {
    eval(await f.text());
}))).then(() => Promise.all(xmlFilesToolbox).then(files => Promise.all(files.map(async f => {
    toolbox += await f.text();
}))).then(_ => toolbox += '</xml>').then(_ => {
    const div = document.getElementById('blocklyDiv');
    const workspace = Blockly.inject(div, {
        toolbox
    });
}));