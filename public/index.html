<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="app.css">
    <script src="closure-library/closure/goog/base.js"></script>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="js/util.js"></script>
    <script>

  /* A note: during the initial integration of less, errors were encountered if the blockly
     scripts here were loaded before less had completed its work; loading them manually as is
     done below remedied that immediate problem. In hindsight, it's not clear that's truly
     necessary: the problem may have been a side effect of something else. Perhaps, then, we could
     go back to the use of <script> blocks. But that would require more work and more testing for
     a change to something that now seems to be working robustly. So we leave as is, for now. */

     var loadBlocklyScripts = function(callback) {

var syncScripts = [
  "ftcblockly/generators/ftcjava.js",
  "ftcblockly/generators/ftcjava/lists.js",
  "ftcblockly/generators/ftcjava/logic.js",
  "ftcblockly/generators/ftcjava/loops.js",
  "ftcblockly/generators/ftcjava/math.js",
  "ftcblockly/generators/ftcjava/procedures.js",
  "ftcblockly/generators/ftcjava/text.js",
  "ftcblockly/generators/ftcjava/variables.js",
  "vars.js",

  "blocks/FtcBlocks_common.js"
];

var asyncScripts = [
  "blocks/acceleration.js",
  "blocks/acceleration_sensor.js",
  "blocks/analog_input.js",
  "blocks/analog_output.js",
  "blocks/android_accelerometer.js",
  "blocks/android_gyroscope.js",
  "blocks/android_orientation.js",
  "blocks/android_sound_pool.js",
  "blocks/android_text_to_speech.js",
  "blocks/angular_velocity.js",
  "blocks/bno055imu.js",
  "blocks/bno055imu_parameters.js",
  "blocks/clipboard_util.js",
  "blocks/color.js",
  "blocks/color_range_sensor.js",
  "blocks/color_sensor.js",
  "blocks/compass_sensor.js",
  "blocks/cr_servo.js",
  "blocks/dbg_log.js",
  "blocks/dc_motor.js",
  "blocks/digital_channel.js",
  "blocks/distance_sensor.js",
  "blocks/elapsed_time.js",
  "blocks/elapsed_time2.js",
  "blocks/gamepad.js",
  "blocks/gyro_sensor.js",
  "blocks/hardware_util.js",
  "blocks/ir_seeker_sensor.js",
  "blocks/led.js",
  "blocks/light_sensor.js",
  "blocks/linear_op_mode.js",
  "blocks/locale.js",
  "blocks/magnetic_flux.js",
  "blocks/matrix_f.js",
  "blocks/misc.js",
  "blocks/mr_i2c_compass_sensor.js",
  "blocks/mr_i2c_range_sensor.js",
  "blocks/navigation.js",
  "blocks/open_gl_matrix.js",
  "blocks/optical_distance_sensor.js",
  "blocks/orientation.js",
  "blocks/pidf_coefficients.js",
  "blocks/position.js",
  "blocks/project_util.js",
  "blocks/quaternion.js",
  "blocks/range.js",
  "blocks/rev_blinkin_led_driver.js",
  "blocks/rumble_effect.js",
  "blocks/servo.js",
  "blocks/servo_controller.js",
  // sound_util.js is not needed
  "blocks/system.js",
  "blocks/telemetry.js",
  "blocks/temperature.js",
  "blocks/tfod.js",
  "blocks/tfod_base.js",
  "blocks/tfod_current_game.js",
  "blocks/tfod_custom_model.js",
  "blocks/tfod_recognition.js",
  "blocks/tfod_rover_ruckus.js",
  "blocks/tfod_sky_stone.js",
  "blocks/toolbox_util.js",
  "blocks/touch_sensor.js",
  "blocks/ultrasonic_sensor.js",
  "blocks/vars.js",
  "blocks/vector_f.js",
  "blocks/velocity.js",
  "blocks/voltage_sensor.js",
  "blocks/vuforia.js",
  "blocks/vuforia_current_game.js",
  "blocks/vuforia_localizer.js",
  "blocks/vuforia_localizer_parameters.js",
  "blocks/vuforia_relic_recovery.js",
  "blocks/vuforia_rover_ruckus.js",
  "blocks/vuforia_sky_stone.js",
  "blocks/vuforia_trackable.js",
  "blocks/vuforia_trackable_default_listener.js",
  "blocks/vuforia_trackables.js"
];

syncLoadScripts(syncScripts, function() {
  asyncLoadScripts(asyncScripts, callback);
});
};
    </script>
    <title>FTC Blocks</title>
</head>
<body>
    <div id="blocklyArea"></div>
    <div id="blocklyDiv"></div>
    <script type="text/javascript">
         loadBlocklyScripts(() => {
            initializeFtcBlocks();
            const div = document.getElementById('blocklyDiv');
            const workspace = Blockly.inject(div, {
                toolbox: document.getElementById('toolbox')
            });
         });
      
        function exportJavaButtonClicked() {
          var javaCode = generateJavaCode();
          if (javaCode) {
            var exportJavaFileName = 'org/firstinspires/ftc/teamcode/' + currentClassName + '.java';
            saveBlocksJava(exportJavaFileName, javaCode, function(success, errorMessage) {
              if (success) {
                // Open the generated java file in OnBotJava.
                window.parent.navToJavaFile(exportJavaFileName);
              } else {
                alert(errorMessage);
              }
            });
          } else {
            alert('Unable to export to Java. Sorry about that!');
          }
        }
      
      </script>
</body>
</html>